#!/usr/bin/env python
import subprocess
import optparse
import re

#  Handles mac address change
def mac_address_change(user_interface, new_mac_address):
    print(f"\n[+] Changing MAC address for {user_interface} to {new_mac_address} \n")

    subprocess.call(["ifconfig", user_interface, "down"])
    subprocess.call(["ifconfig", user_interface, "hw", "ether", new_mac_address])
    subprocess.call(["ifconfig", user_interface, "up"])

#  Handles program options
def get_arguments():
    parser = optparse.OptionParser()

    parser.add_option("-i", "--interface", dest="interface", help="Interface to change its MAC address")
    parser.add_option("-m", "--mac", dest="new_mac", help="The new MAC address you want")

    (options, arguments) = parser.parse_args()

    if not options.interface and not options.new_mac:
        parser.error("Please specify the affected interface as well as the mac address you want to clone")
    elif not options.interface:
        parser.error("You have not included an interface! Use --help for more info")
    elif not options.new_mac:
        parser.error("You have not included a mac address! Use --help for more info")

    return options

def get_current_mac(interface):
    ifconfig_result = subprocess.check_output(["ifconfig", interface])

    mac_address_search_result = re.search(r"\w\w:\w\w:\w\w:\w\w:\w\w:\w\w", ifconfig_result.decode("utf-8"))
    if mac_address_search_result:
        return mac_address_search_result.group(0)
    else:
        print("[-] Could not read mac address!")
        exit()

#  Custom banner :)
print(""" 
 __  __               _____      _____   _____     ____     ____    ______   ______   _____  
|  \/  |     /\      / ____|    / ____| |  __ \   / __ \   / __ \  |  ____| |  ____| |  __ \   ─────█─▄▀█──█▀▄─█─────
| \  / |    /  \    | |        | (___   | |__) | | |  | | | |  | | | |__    | |__    | |__) |  ────▐▌──────────▐▌────
| |\/| |   / /\ \   | |         \___ \  |  ___/  | |  | | | |  | | |  __|   |  __|   |  _  /   ────█▌▀▄──▄▄──▄▀▐█──── 
| |  | |  / ____ \  | |____     ____) | | |      | |__| | | |__| | | |      | |____  | | \ \   ──▄████▄──▐▌──▄████▄──  
|_|  |_| /_/    \_\  \_____|   |_____/  |_|       \____/   \____/  |_|      |______| |_|  \_\  ───▐██──▀▀──▀▀──██▌───                                                                                              
""")

#  Handles main program logic
try:
    usr_options = get_arguments()  # Get user arguments to start program

    current_mac = get_current_mac(usr_options.interface)  # Get current mac address (old)
    print("Your current mac = ", current_mac)

    mac_address_change(usr_options.interface, usr_options.new_mac)  # Change current mac address

    current_mac = get_current_mac(usr_options.interface)  # Get current mac address (changed)
    
    if current_mac == usr_options.new_mac:
        print(f"[+] Mac address changed successfully! You are now using {current_mac}")
        print("Use 'ifconfig' in terminal to confirm the change")
    else:
        print("[-] There was an error changing your mac address, please try again later!")


#Handles errors if main logic fails
except Exception as e:
    print(f"An error has occurred! : {e}")
    print("Type '--help' to view the help manual for more assistance!")
    exit()
